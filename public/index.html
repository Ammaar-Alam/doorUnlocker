<!doctype html>
<html>
    <head>
        <title>Door Control</title>
        <script>
            const clientId = "LrCg71iVReH2gvzTxast5jGBe1dlhpX7";
            const clientSecret =
                "7KHl3gqG2joOzf5Uq5eCFAumyQj4TGxcT0QFrPuMjfJ6uMf3lO4PcJtaj1YX0Wg2";
            const thingId = "3420f1e7-f743-4d7d-91df-ea746d4f01e0";
            const propertyId = "05522adb-784b-4edf-8855-2baf1e132187";

            async function sendCommand(command) {
                const tokenResponse = await fetch(
                    "https://api2.arduino.cc/iot/v1/clients/token",
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                        },
                        body: `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}&audience=https://api2.arduino.cc/iot`,
                    },
                );
                const tokenData = await tokenResponse.json();
                const accessToken = tokenData.access_token;

                const response = await fetch(
                    `https://api2.arduino.cc/iot/v2/things/${thingId}/properties/${propertyId}/publish`,
                    {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${accessToken}`,
                        },
                        body: JSON.stringify({ value: command }),
                    },
                );
                console.log(await response.text());
            }
        </script>
    </head>
    <body>
        <h1>Door Control</h1>
        <button onclick="sendCommand('open')">Open</button>
        <button onclick="sendCommand('close')">Close</button>
    </body>
</html>
